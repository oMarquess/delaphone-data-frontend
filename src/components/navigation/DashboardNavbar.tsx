'use client';

import { ThemeToggle } from '@/components/theme/ThemeToggle';
import Logo from '@/components/logo/Logo';
import { useState, useEffect } from 'react';
import { useSidebar } from './SidebarContext';
import { 
  MenuFoldOutlined, 
  MenuUnfoldOutlined, 
  CalendarOutlined, 
  FilterOutlined, 
  MenuOutlined,
  DownloadOutlined
} from '@ant-design/icons';
import { Download } from 'lucide-react';
import { motion } from 'framer-motion';
import { AIDrawer } from '@/components/ai/AIDrawer';

export default function DashboardNavbar() {
  const [timeRange, setTimeRange] = useState('Last 7 days');
  const [agent, setAgent] = useState('All Agents');
  const { collapsed, toggleSidebar, mobileNavOpen, toggleMobileNav } = useSidebar();
  const [isMobile, setIsMobile] = useState(false);
  const [drawerOpen, setDrawerOpen] = useState(false);
  
  // Check screen size on mount and resize
  useEffect(() => {
    const checkScreenSize = () => {
      setIsMobile(window.innerWidth < 768);
    };
    
    checkScreenSize();
    window.addEventListener('resize', checkScreenSize);
    return () => window.removeEventListener('resize', checkScreenSize);
  }, []);

  const openAIDrawer = () => {
    setDrawerOpen(true);
  };

  const closeAIDrawer = () => {
    setDrawerOpen(false);
  };
  
  return (
    <header className={`fixed top-0 z-30 h-14 md:h-16 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex items-center justify-between transition-all duration-300 ${
      collapsed ? 'lg:left-20' : 'lg:left-64'
    } left-0 right-0`}>
      {/* Left side - Logo and toggle */}
      <div className="flex items-center space-x-2 md:space-x-4 pl-2 md:pl-4">
        {/* Mobile menu button */}
        <button
          className="lg:hidden p-1.5 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
          onClick={toggleMobileNav}
          aria-label={mobileNavOpen ? "Close menu" : "Open menu"}
        >
          <MenuOutlined style={{ fontSize: isMobile ? '16px' : '20px' }} />
        </button>
        
        <Logo />
        
        {/* Desktop sidebar toggle - hidden on mobile */}
        <button
          className="hidden lg:block p-1.5 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"
          onClick={toggleSidebar}
          aria-label={collapsed ? "Expand sidebar" : "Collapse sidebar"}
        >
          {collapsed ? (
            <MenuUnfoldOutlined style={{ fontSize: '18px' }} />
          ) : (
            <MenuFoldOutlined style={{ fontSize: '18px' }} />
          )}
        </button>
      </div>
      
      {/* Right side - Controls */}
      <div className="flex items-center pr-2 md:pr-4">
        {/* Hide on small screens */}
        <div className="hidden md:flex items-center space-x-2 lg:space-x-3">
          {/* <button className="flex items-center space-x-1 px-2 py-1 md:px-3 md:py-1.5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md text-xs md:text-sm text-gray-700 dark:text-gray-300">
            <CalendarOutlined style={{ fontSize: '14px' }} />
            <span>{timeRange}</span>
          </button>
          
          <button className="flex items-center space-x-1 px-2 py-1 md:px-3 md:py-1.5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md text-xs md:text-sm text-gray-700 dark:text-gray-300">
            <FilterOutlined style={{ fontSize: '14px' }} />
            <span>{agent}</span>
          </button> */}
          
          <button 
            className="relative p-2.5 rounded-lg overflow-hidden bg-gradient-to-b from-[#8c45ff] to-[#5F17ED] transition-transform hover:scale-105 group"
            onClick={openAIDrawer}
            aria-label="AI Assistant"
          >
            <div className="absolute inset-0 rounded-lg">
              <div className="border border-white/20 absolute inset-0 rounded-lg [mask-image:linear-gradient(to_bottom,black,transparent)]"></div>
              <div className="border absolute inset-0 rounded-lg border-white/40 [mask-image:linear-gradient(to_top,black,transparent)]"></div>
            </div>
            <div className="relative flex items-center justify-center">
              <motion.div
                animate={{ rotate: 360 }}
                transition={{
                  duration: 20,
                  repeat: Infinity,
                  ease: "linear"
                }}
                className="w-5 h-5"
              >
                <svg
                  viewBox="0 0 512 512"
                  className="w-full h-full fill-white"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path d="M0 0 C2.4142619 0.74187919 4.82961837 1.48020641 7.24609375 2.21484375 C8.38933105 2.56272949 9.53256836 2.91061523 10.71044922 3.26904297 C24.55122243 7.36702729 38.74651187 9.08257979 53.125 9.6875 C73.72588626 10.61015774 73.72588626 10.61015774 81.8125 18.1875 C88.01561218 26.56691415 89.86393081 33.803144 88.8125 44.1875 C85.97061564 52.94899411 80.59970047 58.44746493 72.8125 63.1875 C45.87970482 72.16509839 7.42546109 59.98694848 -18.375 51.75 C-19.22433105 51.48598389 -20.07366211 51.22196777 -20.94873047 50.94995117 C-29.77549028 48.01497062 -37.66755993 43.59204719 -42.1875 35.1875 C-45.39865663 28.47120762 -45.39828595 19.94744517 -43.125 12.875 C-39.99840151 5.96434071 -34.93865282 0.9930134 -28.08203125 -2.12109375 C-18.17576622 -5.73636985 -9.65742721 -3.08333063 0 0 Z" transform="translate(194.1875,447.8125)"/>
                  <path d="M0 0 C10.3336583 6.69449803 18.4399943 16.84321612 26.07421875 26.34375 C26.56921875 26.95847168 27.06421875 27.57319336 27.57421875 28.20654297 C38.35111245 41.73729785 47.04928997 56.49067768 55.19921875 71.71875 C55.5655542 72.40187256 55.93188965 73.08499512 56.30932617 73.78881836 C60.74029797 82.25198507 62.44938183 90.06788716 60.64453125 99.6171875 C58.40561341 106.61035062 53.43023116 112.38760078 46.94921875 115.78125 C39.26225441 119.12404867 31.27183835 119.4841313 23.42285156 116.44946289 C14.38158822 112.19292633 10.37337412 104.2398376 6.07421875 95.65625 C0.24920166 84.2256514 -6.17820866 73.46204449 -14.17578125 63.40625 C-14.62904785 62.83052246 -15.08231445 62.25479492 -15.54931641 61.66162109 C-18.94568789 57.41239072 -22.56816528 53.42303694 -26.30078125 49.46875 C-33.2908242 42.03643922 -38.83338323 35.23223129 -38.95703125 24.67578125 C-38.4895703 16.20305149 -36.37411046 10.34314378 -30.11328125 4.53125 C-21.78358792 -2.15081168 -10.12163517 -4.58338196 0 0 Z" transform="translate(430.92578125,67.65625)"/>
                  <path d="M0 0 C4.48018508 4.48018508 7.01713386 10.27416197 9.91796875 15.83203125 C18.59249868 32.44427296 28.80325939 47.45858009 41.640625 61.140625 C48.69950738 68.69417328 54.74552873 75.78088881 54.85546875 86.4921875 C54.40028459 94.96561563 52.2747195 100.83034154 46.015625 106.640625 C38.8879342 112.34798985 33.43195171 113.48271361 24.3203125 113.22265625 C11.46093959 111.76986356 3.26801643 101.07527999 -4.546875 91.703125 C-6.09607533 89.75074597 -7.63694907 87.79174613 -9.171875 85.828125 C-10.18087057 84.57151901 -11.18999322 83.31501506 -12.19921875 82.05859375 C-22.76305068 68.74810193 -31.28413722 54.41199126 -39.296875 39.453125 C-39.66329102 38.76992188 -40.02970703 38.08671875 -40.40722656 37.3828125 C-44.79657442 28.99819387 -47.04326977 20.71826029 -44.484375 11.296875 C-41.32180174 3.60128008 -36.70757685 -2.06585373 -29.046875 -5.4609375 C-18.757551 -9.36230618 -8.36780871 -6.78649053 0 0 Z" transform="translate(66.171875,331.171875)"/>
                  <path d="M0 0 C4.95571972 4.07470288 9.72828642 9.57746814 11 16 C12.90135422 46.84389931 7.94292718 77.04208887 -1.5 106.375 C-1.77239502 107.23722168 -2.04479004 108.09944336 -2.32543945 108.98779297 C-5.13908192 117.36340221 -9.23877027 123.52505673 -17 128 C-23.17770371 131.01701809 -30.94780985 131.10059486 -37.53125 129.3125 C-45.22650384 126.15006692 -50.89902901 121.5348874 -54.2890625 113.87109375 C-57.71615389 104.85144113 -55.67309968 96.97457315 -52.75 88.1875 C-46.43069636 68.30023291 -42.88460121 48.42103792 -42.5168457 27.53173828 C-42.23011259 17.93870619 -40.08253618 8.86883897 -33 2 C-22.48447845 -5.33895775 -11.38041585 -6.21858438 0 0 Z" transform="translate(501,232)"/>
                  <path d="M0 0 C6.56730843 4.21299032 9.91525799 10.2683953 11.63671875 17.77734375 C12.84356354 27.0298205 10.36606094 33.52176614 5 41 C-1.68136914 48.41772749 -9.12544847 54.88207919 -17 61 C-17.56783203 61.44956055 -18.13566406 61.89912109 -18.72070312 62.36230469 C-63.0069783 97.34135733 -63.0069783 97.34135733 -83.83203125 96.34375 C-92.1960312 95.01756622 -98.94646529 91.8936805 -104 85 C-108.72141289 77.94598431 -109.06999427 70.26899084 -108 62 C-105.53723905 53.8816066 -100.71598633 48.74791905 -93.47094727 44.52636719 C-90.60458046 43.01634055 -87.71559045 41.56309407 -84.8125 40.125 C-76.46164317 35.87163026 -68.55021177 31.58011278 -61 26 C-59.42605469 24.84951172 -59.42605469 24.84951172 -57.8203125 23.67578125 C-51.61178565 19.05808065 -45.83569973 14.11463663 -40.17675781 8.8425293 C-27.86133536 -2.59880255 -16.09948255 -8.45432099 0 0 Z" transform="translate(434,395)"/>
                  <path d="M0 0 C5.82603901 3.39613112 10.62316668 8.31437352 13.0234375 14.734375 C14.82811587 23.07731434 14.28279868 30.97366506 10.375 38.55859375 C4.65193406 45.81973366 -2.56944145 49.85748002 -10.75 53.875 C-19.08499025 58.10515682 -26.98757596 62.34336969 -34.5 67.9375 C-35.29978271 68.52966309 -35.29978271 68.52966309 -36.11572266 69.13378906 C-42.37805008 73.80514682 -48.31980256 78.67977253 -53.95751953 84.09228516 C-61.86934695 91.68513942 -68.07836365 97.0332647 -79.5 97.5625 C-88.19174605 97.2038829 -94.3735157 94.47821721 -100.4375 88.25 C-105.21698306 82.21632635 -106.84941967 75.94885695 -106.4375 68.3125 C-104.68984972 55.35076041 -95.15653565 46.90677825 -85.5 38.9375 C-84.94812012 38.47327637 -84.39624023 38.00905273 -83.82763672 37.53076172 C-71.16440085 26.88567721 -58.07486817 17.88802953 -43.75 9.625 C-42.89897705 9.13314209 -42.0479541 8.64128418 -41.17114258 8.13452148 C-28.58021093 0.99297906 -14.48553501 -6.72463954 0 0 Z" transform="translate(173.5,22.0625)"/>
                  <path d="M0 0 C5.55244283 5.26173901 8.12104785 10.98024338 8.625 18.5 C8.46755505 26.10983927 6.10003317 32.93106963 3.78295898 40.12915039 C-1.5716833 56.79089284 -4.6271322 73.88026011 -5.3359375 91.3737793 C-5.79041423 102.56636114 -6.49554139 112.75214144 -15 121 C-22.32337229 126.11110358 -29.11670531 127.91501748 -38 127 C-47.25715057 124.53499898 -53.22315998 119.21249035 -58 111 C-66.66952092 83.34781646 -55.02016512 45.18174422 -46.5 18.75 C-46.22760498 17.89220947 -45.95520996 17.03441895 -45.67456055 16.15063477 C-42.42510127 6.45573025 -38.32215613 -0.31596096 -29 -5 C-19.25297215 -8.98341463 -7.96443137 -6.70493989 0 0 Z" transform="translate(59,155)"/>
                  <path d="M0 0 C0.67773468 0.00304138 1.35546936 0.00608276 2.05374146 0.00921631 C29.14156019 0.18728246 70.55453662 2.50580953 92.3984375 20.93359375 C97.72265071 26.3564035 100.15925728 32.17400295 100.25 39.6875 C100.12232113 47.7495088 97.74918122 54.72208043 91.875 60.4375 C83.70840071 65.66412354 76.61633556 67.82391489 66.875 66.4375 C59.39468748 64.73807416 52.06379598 62.43479278 44.71191406 60.2578125 C29.55092388 55.87391172 14.0386673 54.29188285 -1.67993164 53.86669922 C-13.02441317 53.48428869 -20.49639192 51.37035717 -28.4375 43 C-33.49057637 35.32680995 -34.19439099 28.59352382 -33.125 19.4375 C-30.61039512 11.08901181 -25.67642296 6.05081703 -18.28125 1.8046875 C-12.49713557 -0.56306527 -6.14143031 -0.04769308 0 0 Z" transform="translate(263.125,-0.4375)"/>
                </svg>
              </motion.div>
              <div className="absolute -top-1 -right-1 w-2 h-2 bg-white rounded-full animate-ping"></div>
            </div>
          </button>
        </div>
        
        {/* Mobile controls - simplified version */}
        <div className="md:hidden flex items-center space-x-2">
          <button className="p-1.5 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
            <FilterOutlined style={{ fontSize: '14px' }} />
          </button>
          <button className="p-1.5 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
            <CalendarOutlined style={{ fontSize: '14px' }} />
          </button>
          <button 
            className="relative p-1.5 rounded-full overflow-hidden bg-gradient-to-b from-[#8c45ff] to-[#5F17ED] group"
            onClick={openAIDrawer}
            aria-label="AI Assistant"
          >
            <motion.div
              animate={{ rotate: 360 }}
              transition={{
                duration: 20,
                repeat: Infinity,
                ease: "linear"
              }}
              className="w-4 h-4"
            >
              <svg
                viewBox="0 0 512 512"
                className="w-full h-full fill-white"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path d="M0 0 C2.4142619 0.74187919 4.82961837 1.48020641 7.24609375 2.21484375 C8.38933105 2.56272949 9.53256836 2.91061523 10.71044922 3.26904297 C24.55122243 7.36702729 38.74651187 9.08257979 53.125 9.6875 C73.72588626 10.61015774 73.72588626 10.61015774 81.8125 18.1875 C88.01561218 26.56691415 89.86393081 33.803144 88.8125 44.1875 C85.97061564 52.94899411 80.59970047 58.44746493 72.8125 63.1875 C45.87970482 72.16509839 7.42546109 59.98694848 -18.375 51.75 C-19.22433105 51.48598389 -20.07366211 51.22196777 -20.94873047 50.94995117 C-29.77549028 48.01497062 -37.66755993 43.59204719 -42.1875 35.1875 C-45.39865663 28.47120762 -45.39828595 19.94744517 -43.125 12.875 C-39.99840151 5.96434071 -34.93865282 0.9930134 -28.08203125 -2.12109375 C-18.17576622 -5.73636985 -9.65742721 -3.08333063 0 0 Z" transform="translate(194.1875,447.8125)"/>
                <path d="M0 0 C10.3336583 6.69449803 18.4399943 16.84321612 26.07421875 26.34375 C26.56921875 26.95847168 27.06421875 27.57319336 27.57421875 28.20654297 C38.35111245 41.73729785 47.04928997 56.49067768 55.19921875 71.71875 C55.5655542 72.40187256 55.93188965 73.08499512 56.30932617 73.78881836 C60.74029797 82.25198507 62.44938183 90.06788716 60.64453125 99.6171875 C58.40561341 106.61035062 53.43023116 112.38760078 46.94921875 115.78125 C39.26225441 119.12404867 31.27183835 119.4841313 23.42285156 116.44946289 C14.38158822 112.19292633 10.37337412 104.2398376 6.07421875 95.65625 C0.24920166 84.2256514 -6.17820866 73.46204449 -14.17578125 63.40625 C-14.62904785 62.83052246 -15.08231445 62.25479492 -15.54931641 61.66162109 C-18.94568789 57.41239072 -22.56816528 53.42303694 -26.30078125 49.46875 C-33.2908242 42.03643922 -38.83338323 35.23223129 -38.95703125 24.67578125 C-38.4895703 16.20305149 -36.37411046 10.34314378 -30.11328125 4.53125 C-21.78358792 -2.15081168 -10.12163517 -4.58338196 0 0 Z" transform="translate(430.92578125,67.65625)"/>
                <path d="M0 0 C4.48018508 4.48018508 7.01713386 10.27416197 9.91796875 15.83203125 C18.59249868 32.44427296 28.80325939 47.45858009 41.640625 61.140625 C48.69950738 68.69417328 54.74552873 75.78088881 54.85546875 86.4921875 C54.40028459 94.96561563 52.2747195 100.83034154 46.015625 106.640625 C38.8879342 112.34798985 33.43195171 113.48271361 24.3203125 113.22265625 C11.46093959 111.76986356 3.26801643 101.07527999 -4.546875 91.703125 C-6.09607533 89.75074597 -7.63694907 87.79174613 -9.171875 85.828125 C-10.18087057 84.57151901 -11.18999322 83.31501506 -12.19921875 82.05859375 C-22.76305068 68.74810193 -31.28413722 54.41199126 -39.296875 39.453125 C-39.66329102 38.76992188 -40.02970703 38.08671875 -40.40722656 37.3828125 C-44.79657442 28.99819387 -47.04326977 20.71826029 -44.484375 11.296875 C-41.32180174 3.60128008 -36.70757685 -2.06585373 -29.046875 -5.4609375 C-18.757551 -9.36230618 -8.36780871 -6.78649053 0 0 Z" transform="translate(66.171875,331.171875)"/>
                <path d="M0 0 C4.95571972 4.07470288 9.72828642 9.57746814 11 16 C12.90135422 46.84389931 7.94292718 77.04208887 -1.5 106.375 C-1.77239502 107.23722168 -2.04479004 108.09944336 -2.32543945 108.98779297 C-5.13908192 117.36340221 -9.23877027 123.52505673 -17 128 C-23.17770371 131.01701809 -30.94780985 131.10059486 -37.53125 129.3125 C-45.22650384 126.15006692 -50.89902901 121.5348874 -54.2890625 113.87109375 C-57.71615389 104.85144113 -55.67309968 96.97457315 -52.75 88.1875 C-46.43069636 68.30023291 -42.88460121 48.42103792 -42.5168457 27.53173828 C-42.23011259 17.93870619 -40.08253618 8.86883897 -33 2 C-22.48447845 -5.33895775 -11.38041585 -6.21858438 0 0 Z" transform="translate(501,232)"/>
                <path d="M0 0 C6.56730843 4.21299032 9.91525799 10.2683953 11.63671875 17.77734375 C12.84356354 27.0298205 10.36606094 33.52176614 5 41 C-1.68136914 48.41772749 -9.12544847 54.88207919 -17 61 C-17.56783203 61.44956055 -18.13566406 61.89912109 -18.72070312 62.36230469 C-63.0069783 97.34135733 -63.0069783 97.34135733 -83.83203125 96.34375 C-92.1960312 95.01756622 -98.94646529 91.8936805 -104 85 C-108.72141289 77.94598431 -109.06999427 70.26899084 -108 62 C-105.53723905 53.8816066 -100.71598633 48.74791905 -93.47094727 44.52636719 C-90.60458046 43.01634055 -87.71559045 41.56309407 -84.8125 40.125 C-76.46164317 35.87163026 -68.55021177 31.58011278 -61 26 C-59.42605469 24.84951172 -59.42605469 24.84951172 -57.8203125 23.67578125 C-51.61178565 19.05808065 -45.83569973 14.11463663 -40.17675781 8.8425293 C-27.86133536 -2.59880255 -16.09948255 -8.45432099 0 0 Z" transform="translate(434,395)"/>
                <path d="M0 0 C5.82603901 3.39613112 10.62316668 8.31437352 13.0234375 14.734375 C14.82811587 23.07731434 14.28279868 30.97366506 10.375 38.55859375 C4.65193406 45.81973366 -2.56944145 49.85748002 -10.75 53.875 C-19.08499025 58.10515682 -26.98757596 62.34336969 -34.5 67.9375 C-35.29978271 68.52966309 -35.29978271 68.52966309 -36.11572266 69.13378906 C-42.37805008 73.80514682 -48.31980256 78.67977253 -53.95751953 84.09228516 C-61.86934695 91.68513942 -68.07836365 97.0332647 -79.5 97.5625 C-88.19174605 97.2038829 -94.3735157 94.47821721 -100.4375 88.25 C-105.21698306 82.21632635 -106.84941967 75.94885695 -106.4375 68.3125 C-104.68984972 55.35076041 -95.15653565 46.90677825 -85.5 38.9375 C-84.94812012 38.47327637 -84.39624023 38.00905273 -83.82763672 37.53076172 C-71.16440085 26.88567721 -58.07486817 17.88802953 -43.75 9.625 C-42.89897705 9.13314209 -42.0479541 8.64128418 -41.17114258 8.13452148 C-28.58021093 0.99297906 -14.48553501 -6.72463954 0 0 Z" transform="translate(173.5,22.0625)"/>
                <path d="M0 0 C5.55244283 5.26173901 8.12104785 10.98024338 8.625 18.5 C8.46755505 26.10983927 6.10003317 32.93106963 3.78295898 40.12915039 C-1.5716833 56.79089284 -4.6271322 73.88026011 -5.3359375 91.3737793 C-5.79041423 102.56636114 -6.49554139 112.75214144 -15 121 C-22.32337229 126.11110358 -29.11670531 127.91501748 -38 127 C-47.25715057 124.53499898 -53.22315998 119.21249035 -58 111 C-66.66952092 83.34781646 -55.02016512 45.18174422 -46.5 18.75 C-46.22760498 17.89220947 -45.95520996 17.03441895 -45.67456055 16.15063477 C-42.42510127 6.45573025 -38.32215613 -0.31596096 -29 -5 C-19.25297215 -8.98341463 -7.96443137 -6.70493989 0 0 Z" transform="translate(59,155)"/>
                <path d="M0 0 C0.67773468 0.00304138 1.35546936 0.00608276 2.05374146 0.00921631 C29.14156019 0.18728246 70.55453662 2.50580953 92.3984375 20.93359375 C97.72265071 26.3564035 100.15925728 32.17400295 100.25 39.6875 C100.12232113 47.7495088 97.74918122 54.72208043 91.875 60.4375 C83.70840071 65.66412354 76.61633556 67.82391489 66.875 66.4375 C59.39468748 64.73807416 52.06379598 62.43479278 44.71191406 60.2578125 C29.55092388 55.87391172 14.0386673 54.29188285 -1.67993164 53.86669922 C-13.02441317 53.48428869 -20.49639192 51.37035717 -28.4375 43 C-33.49057637 35.32680995 -34.19439099 28.59352382 -33.125 19.4375 C-30.61039512 11.08901181 -25.67642296 6.05081703 -18.28125 1.8046875 C-12.49713557 -0.56306527 -6.14143031 -0.04769308 0 0 Z" transform="translate(263.125,-0.4375)"/>
              </svg>
            </motion.div>
            <div className="absolute -top-0.5 -right-0.5 w-1.5 h-1.5 bg-white rounded-full animate-ping"></div>
          </button>
        </div>
        
        {/* Always visible */}
        <div className="ml-2 md:ml-3">
          <ThemeToggle />
        </div>
      </div>

      {/* AI Drawer Component */}
      <AIDrawer open={drawerOpen} onClose={closeAIDrawer} />
    </header>
  );
} 